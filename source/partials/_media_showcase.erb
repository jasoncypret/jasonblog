<%
# Local variables:
# - title: String (required)
# - description: String (required)
# - footer_title: String (optional)
# - footer_description: String (optional)
# - items: Array of Hashes (required)
#   Each item should have:
#   - type: 'image' or 'video'
#   - src: path to media
#   - thumbnail: path to thumbnail (required for videos)
#   - alt: alt text
#   - caption_title: String (optional)
#   - caption_description: String (optional)
#   - span: String (optional) - 'span-2' or 'span-2-rows'
%>

<section class="media-showcase">
  <div class="media-showcase-header">
    <h2 class="media-showcase-header-title"><%= title %></h2>
    <p class="media-showcase-header-description"><%= description %></p>
  </div>

  <div class="media-showcase-grid">
    <% items.each do |item| %>
      <div class="media-showcase-grid-item gallery-item <%= item[:span] %>">
        <% if item[:type] == 'video' %>
          <%# Video thumbnail with responsive image %>
          <picture>
            <%# WebP version %>
            <source
              type="image/webp"
              srcset="<%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_mobile.webp') %> 300w,
                      <%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_thumb.webp') %> 600w"
              sizes="(max-width: 768px) 300px, 600px">
            
            <%# Fallback version %>
            <img class="gallery-thumbnail lazyload" 
                 src="<%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_mobile.jpg') %>"
                 srcset="<%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_mobile.jpg') %> 300w,
                         <%= item[:thumbnail] %> 600w"
                 sizes="(max-width: 768px) 300px, 600px"
                 data-lightbox="<%= item[:src] %>"
                 loading="lazy"
                 decoding="async"
                 alt="<%= item[:alt] %>">
          </picture>
          
          <%# Hidden video preload for lightbox %>
          <video preload="metadata" class="lightbox-video-preload" hidden
                 poster="<%= item[:thumbnail] %>">
            <source src="<%= item[:src].gsub('.mp4', '_mobile.mp4') %>" 
                    type="video/mp4" 
                    media="(max-width: 768px)">
            <source src="<%= item[:src] %>" 
                    type="video/mp4">
          </video>
        <% else %>
          <%# Image with responsive sizes %>
          <picture>
            <%# WebP version %>
            <source
              type="image/webp"
              srcset="<%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_mobile.webp') %> 300w,
                      <%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_thumb.webp') %> 600w"
              sizes="(max-width: 768px) 300px, 600px">
            
            <%# Fallback version %>
            <img class="gallery-thumbnail lazyload" 
                 src="<%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_mobile.jpg') %>"
                 srcset="<%= item[:thumbnail].gsub(/\.(jpg|jpeg|png)$/, '_mobile.jpg') %> 300w,
                         <%= item[:thumbnail] %> 600w"
                 sizes="(max-width: 768px) 300px, 600px"
                 data-lightbox="<%= item[:src] %>"
                 loading="lazy"
                 decoding="async"
                 alt="<%= item[:alt] %>">
          </picture>
        <% end %>
        
        <% if item[:caption_title] %>
          <h3 class="gallery-item-title"><%= item[:caption_title] %></h3>
        <% end %>
        <% if item[:caption_description] %>
          <p class="gallery-item-description"><%= item[:caption_description] %></p>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if defined?(footer_title) && footer_title.present? %>
    <div class="media-showcase-footer">
      <h3 class="media-showcase-footer-title"><%= footer_title %></h3>
      <div class="media-showcase-footer-description"><%= footer_description %></div>
    </div>
  <% end %>
</section> 